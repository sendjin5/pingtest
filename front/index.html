<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>WIFI 대시보드</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
    }
    li {
        list-style: none;
        cursor: pointer;
        margin: 15px 0;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      text-align: center;
      border: 1px solid #ddd;
      padding: 8px;
    }
    /* 각 열의 너비 설정 */
    th:nth-child(1), td:nth-child(1) { width: 8%; }  /* 상태 아이콘 */
    th:nth-child(2), td:nth-child(2) { width: 25%; } /* 라벨 */
    th:nth-child(3), td:nth-child(3) { width: 20%; } /* IP */
    th:nth-child(4), td:nth-child(4) { width: 20%; } /* 상태 */
    th:nth-child(5), td:nth-child(5) { width: 15%; } /* 시간 */
  </style>
</head>
<body>
  <h2>네트워크 테스트</h2>
  <div style="display:flex; gap: 10px;">
    <button onclick="checkAll()">테스트</button>
    <button onclick="openAllIPs()">모든 IP 웹주소 열기</button>
  </div>
  <table>
    <thead>
      <tr>
        <th>여부</th>
        <th>위치</th>
        <th>IP</th>
        <th>시간</th>
        <th>응답</th>
    </tr>
    </thead>
    <tbody>
     
    </tbody>
  </table>
  <script>
    function openAllIPs() {
      // fetch(`/api/ip-list`)
      fetch('http://localhost:8080/ip-list')
        .then(res => res.json())
        .then(ipList => {
          if (ipList.length === 0) {
            alert('IP 목록이 비어있습니다.'); 
            return;
          }
          
          const confirmMessage = `총 ${ipList.length}개의 IP를 웹주소로 열겠습니다`;
          
          if (confirm(confirmMessage)) {
            ipList.forEach(({ label, ip }) => {
              const url = `http://${ip}`;
              window.open(url, '_blank');
            });
          }
        })
        .catch(err => {
          alert('IP 목록을 가져오는 중 오류가 발생했습니다: ' + err);
        });
    }

    function checkAll() {
      const resultList = document.querySelector("tbody");
      resultList.innerHTML = "<tr><td colspan='5'>테스트 중...</td></tr>";

      // fetch(`/api/ping-all`)
      fetch('http://localhost:8080/ping-all')
        .then(res => res.json())
        .then(data => {
          resultList.innerHTML = "";
          data.forEach(entry => {
            const tr = document.createElement("tr");
            const tr2 = document.createElement("tr");
            
            // 각 데이터를 별도의 td로 분리
            const statusTd = document.createElement("td");
            const labelTd = document.createElement("td");
            const ipTd = document.createElement("td");
            const statusTextTd = document.createElement("td");
            const timeTd = document.createElement("td");
            
            statusTd.textContent = entry.status === '응답 완료' ? '✅' : '❌';
            labelTd.textContent = entry.label;
            ipTd.textContent = entry.ip;
            statusTextTd.textContent = entry.status;
            timeTd.textContent = entry.time || '-';
            
            tr.appendChild(statusTd);
            tr.appendChild(labelTd);
            tr.appendChild(ipTd);
            tr.appendChild(statusTextTd);
            tr.appendChild(timeTd);
            
            // 상세 정보 표시용 행 (클릭 시 토글)
            const detailTd = document.createElement("td");
            detailTd.colSpan = 5;
            detailTd.innerHTML = `<pre style="white-space: pre-wrap; margin-left: 20px; background-color: #f5f5f5; padding: 10px;">${entry.stdout}</pre>`;
            tr2.appendChild(detailTd);
            tr2.style.display = "none";

            tr.addEventListener("click", () => {
              tr2.style.display = tr2.style.display === "none" ? "table-row" : "none";
            });
            
            tr.style.cursor = "pointer";
            tr.style.textAlign = "left";
            resultList.appendChild(tr);
            resultList.appendChild(tr2);
          });
        })
        .catch(err => {
          resultList.innerHTML = "에러 발생: " + err;
        });
    }
  </script>
</body>
</html>
